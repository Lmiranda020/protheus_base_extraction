import time

def clicar_botao_shadow_por_texto(driver, texto, seletor_interno='button', timeout=10):
    """
    Clica em um bot√£o Shadow DOM buscando por texto vis√≠vel
    
    Args:
        texto: Texto vis√≠vel no bot√£o (ex: 'OK', 'Entrar')
        seletor_interno: Seletor do elemento interno (padr√£o: 'button')
    
    Exemplo:
        clicar_botao_shadow_por_texto(driver, 'Ok')
    """
    try:
        print(f"üîç Procurando bot√£o Shadow DOM com texto '{texto}'...")
        
        script = f"""
            function findButtonByText(root, targetText) {{
                var elements = root.querySelectorAll('*');
                
                for (var i = 0; i < elements.length; i++) {{
                    var el = elements[i];
                    
                    if (el.shadowRoot) {{
                        var innerBtn = el.shadowRoot.querySelector('{seletor_interno}');
                        
                        if (innerBtn) {{
                            var text = innerBtn.textContent.trim();
                            if (text === targetText || text.includes(targetText)) {{
                                console.log('‚úì Bot√£o encontrado:', text);
                                innerBtn.click();
                                return true;
                            }}
                        }}
                        
                        // Buscar recursivamente
                        if (findButtonByText(el.shadowRoot, targetText)) {{
                            return true;
                        }}
                    }}
                }}
                return false;
            }}
            
            return findButtonByText(document, '{texto}');
        """
        
        resultado = driver.execute_script(script)
        
        if resultado:
            print(f"‚úÖ Bot√£o com texto '{texto}' clicado!")
            time.sleep(0.5)
            return True
        else:
            print(f"‚ùå Bot√£o com texto '{texto}' n√£o encontrado")
            return False
            
    except Exception as e:
        print(f"‚ùå Erro ao clicar por texto '{texto}': {e}")
        return False
    